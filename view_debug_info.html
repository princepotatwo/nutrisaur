<!DOCTYPE html>
<html>
<head>
    <title>Debug Info Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .user { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .normal { background-color: #e8f5e8; }
        .other { background-color: #f5f5f5; }
        .debug-info { background-color: #f0f0f0; padding: 10px; margin: 10px 0; }
        pre { background-color: #f9f9f9; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>WHO Classification Debug Info</h1>
    <button onclick="loadDebugInfo()">Load Debug Info</button>
    <div id="debugInfo"></div>

    <script>
        async function loadDebugInfo() {
            try {
                const response = await fetch('/api/DatabaseAPI.php?action=get_who_classifications&who_standard=weight-for-age&time_frame=1d&barangay=');
                const result = await response.json();
                
                if (result.success && result.data.debug_info) {
                    displayDebugInfo(result.data.debug_info);
                } else {
                    document.getElementById('debugInfo').innerHTML = '<p>No debug info available</p>';
                }
            } catch (error) {
                document.getElementById('debugInfo').innerHTML = '<p>Error: ' + error.message + '</p>';
            }
        }
        
        function displayDebugInfo(debugInfo) {
            const normalUsers = debugInfo.filter(user => 
                user.weight_for_age_result && 
                user.weight_for_age_result.classification === 'Normal'
            );
            
            let html = '<h2>Summary</h2>';
            html += '<p>Total users: ' + debugInfo.length + '</p>';
            html += '<p>Normal users: ' + normalUsers.length + '</p>';
            
            html += '<h2>Normal Users Details</h2>';
            normalUsers.forEach((user, index) => {
                html += '<div class="user normal">';
                html += '<h3>User ' + (index + 1) + '</h3>';
                html += '<p><strong>Name:</strong> ' + (user.name || 'Unknown') + '</p>';
                html += '<p><strong>Age:</strong> ' + (user.age_months || 'Unknown') + ' months</p>';
                html += '<p><strong>Weight:</strong> ' + (user.weight || 'Unknown') + ' kg</p>';
                html += '<p><strong>Sex:</strong> ' + (user.sex || 'Unknown') + '</p>';
                
                if (user.weight_for_age_result) {
                    html += '<p><strong>Classification:</strong> ' + user.weight_for_age_result.classification + '</p>';
                    html += '<p><strong>Age Used:</strong> ' + user.weight_for_age_result.age_used + '</p>';
                    html += '<p><strong>Weight Range:</strong> ' + user.weight_for_age_result.weight_range + '</p>';
                    html += '<p><strong>Z-Score:</strong> ' + user.weight_for_age_result.z_score + '</p>';
                }
                
                html += '</div>';
            });
            
            html += '<h2>All Users (First 10)</h2>';
            debugInfo.slice(0, 10).forEach((user, index) => {
                const isNormal = user.weight_for_age_result && 
                                user.weight_for_age_result.classification === 'Normal';
                html += '<div class="user ' + (isNormal ? 'normal' : 'other') + '">';
                html += '<h3>User ' + (index + 1) + '</h3>';
                html += '<p><strong>Name:</strong> ' + (user.name || 'Unknown') + '</p>';
                html += '<p><strong>Age:</strong> ' + (user.age_months || 'Unknown') + ' months</p>';
                html += '<p><strong>Weight:</strong> ' + (user.weight || 'Unknown') + ' kg</p>';
                html += '<p><strong>Sex:</strong> ' + (user.sex || 'Unknown') + '</p>';
                
                if (user.weight_for_age_result) {
                    html += '<p><strong>Classification:</strong> ' + user.weight_for_age_result.classification + '</p>';
                    html += '<p><strong>Age Used:</strong> ' + user.weight_for_age_result.age_used + '</p>';
                    html += '<p><strong>Weight Range:</strong> ' + user.weight_for_age_result.weight_range + '</p>';
                }
                
                html += '</div>';
            });
            
            document.getElementById('debugInfo').innerHTML = html;
        }
    </script>
</body>
</html>
