digraph WHOGrowthStandardsUpdatedDecisionTree {
    // Graph styling
    rankdir=TB;
    node [shape=box, style=filled, fontname="Arial", fontsize=10];
    edge [fontname="Arial", fontsize=9];
    
    // Start node
    start [label="Input: Weight, Height, Birth Date, Sex", fillcolor="#e1f5fe", shape=ellipse];
    
    // Validation
    validate [label="Validate Input\n• Weight: 0.1-200 kg\n• Height: 1-300 cm\n• Age: 0-228 months (0-19 years)\n• Sex: Male/Female", fillcolor="#fff3e0"];
    
    // Age calculation
    calcAge [label="Calculate Age in Months\nAge = (Current Date - Birth Date) / 30.44", fillcolor="#f3e5f5"];
    
    // BMI calculation
    calcBMI [label="Calculate BMI\nBMI = Weight(kg) / Height(m)²", fillcolor="#f3e5f5"];
    
    // Age range decision
    ageCheck [label="Age Range Check", fillcolor="#e8f5e8", shape=diamond];
    
    // WHO Growth Standards path (0-60 months)
    growthStandards [label="WHO Growth Standards\n(0-60 months / 0-5 years)", fillcolor="#c8e6c9"];
    
    // WHO Growth References path (61-228 months)
    growthReferences [label="WHO Growth References\n(61-228 months / 5-19 years)", fillcolor="#c8e6c9"];
    
    // Out of range
    outOfRange [label="Age Out of Range\n(>228 months / >19 years)", fillcolor="#ffcdd2"];
    
    // Growth Standards indicators
    wfa [label="Weight-for-Age\n(0-60 months)", fillcolor="#e8f5e8"];
    hfa [label="Height-for-Age\n(0-60 months)", fillcolor="#e8f5e8"];
    wfh [label="Weight-for-Height\n(45-120 cm)", fillcolor="#e8f5e8"];
    wfl [label="Weight-for-Length\n(45-110 cm)", fillcolor="#e8f5e8"];
    bfaStandards [label="BMI-for-Age\n(0-60 months)", fillcolor="#e8f5e8"];
    
    // Growth References indicator
    bfaReferences [label="BMI-for-Age\n(61-228 months)", fillcolor="#e8f5e8"];
    
    // Z-score calculations for standards
    wfaCalc [label="WFA Z-Score\nZ = (Weight - Median) / SD", fillcolor="#fff9c4"];
    hfaCalc [label="HFA Z-Score\nZ = (Height - Median) / SD", fillcolor="#fff9c4"];
    wfhCalc [label="WFH Z-Score\nZ = (Weight - Median) / SD", fillcolor="#fff9c4"];
    wflCalc [label="WFL Z-Score\nZ = (Weight - Median) / SD", fillcolor="#fff9c4"];
    bfaStandardsCalc [label="BFA Z-Score (Standards)\nZ = (BMI - Median) / SD", fillcolor="#fff9c4"];
    
    // Z-score calculation for references
    bfaReferencesCalc [label="BFA Z-Score (References)\nZ = (BMI - Median) / SD", fillcolor="#fff9c4"];
    
    // Classifications for standards
    wfaClass [label="WFA Classification\nZ < -3: Severely Wasted\n-3 ≤ Z < -2: Wasted\n-2 ≤ Z ≤ 2: Normal\n2 < Z ≤ 3: Overweight\nZ > 3: Obese", fillcolor="#ffebee"];
    hfaClass [label="HFA Classification\nZ < -3: Severely Wasted\n-3 ≤ Z < -2: Wasted\n-2 ≤ Z ≤ 2: Normal\n2 < Z ≤ 3: Overweight\nZ > 3: Obese", fillcolor="#ffebee"];
    wfhClass [label="WFH Classification\nZ < -3: Severely Wasted\n-3 ≤ Z < -2: Wasted\n-2 ≤ Z ≤ 2: Normal\n2 < Z ≤ 3: Overweight\nZ > 3: Obese", fillcolor="#ffebee"];
    wflClass [label="WFL Classification\nZ < -3: Severely Wasted\n-3 ≤ Z < -2: Wasted\n-2 ≤ Z ≤ 2: Normal\n2 < Z ≤ 3: Overweight\nZ > 3: Obese", fillcolor="#ffebee"];
    bfaStandardsClass [label="BFA Classification (Standards)\nZ < -3: Severely Wasted\n-3 ≤ Z < -2: Wasted\n-2 ≤ Z ≤ 2: Normal\n2 < Z ≤ 3: Overweight\nZ > 3: Obese", fillcolor="#ffebee"];
    
    // Classification for references
    bfaReferencesClass [label="BFA Classification (References)\nZ < -3: Severe Thinness\n-3 ≤ Z < -2: Thinness\n-2 ≤ Z ≤ 1: Normal\n1 < Z ≤ 2: Overweight\nZ > 2: Obesity", fillcolor="#ffebee"];
    
    // Risk assessment
    riskAssess [label="Risk Assessment\n• Severe: Any indicator = Severely Wasted/Severe Thinness\n• Moderate: Any indicator = Wasted/Thinness/Overweight\n• Low: All indicators = Normal", fillcolor="#e3f2fd"];
    
    // Recommendations
    recommendations [label="Generate Recommendations\n• Severe: Immediate medical attention\n• Moderate: Follow-up within 2 weeks\n• Low: Continue regular monitoring", fillcolor="#f1f8e9"];
    
    // Database storage
    saveDB [label="Save to Database\n• Store all Z-scores\n• Store classifications\n• Update risk level", fillcolor="#fce4ec"];
    
    // Final output
    output [label="Output Results\n• All Z-scores\n• Classifications\n• Risk level\n• Recommendations", fillcolor="#e8f5e8", shape=ellipse];
    
    // Error handling
    error [label="Error Handling\n• Invalid input\n• Age out of range", fillcolor="#ffcdd2", shape=diamond];
    
    // Flow connections
    start -> validate;
    validate -> calcAge [label="Valid"];
    validate -> error [label="Invalid"];
    
    calcAge -> calcBMI;
    calcBMI -> ageCheck;
    
    // Age routing
    ageCheck -> growthStandards [label="0-60 months"];
    ageCheck -> growthReferences [label="61-228 months"];
    ageCheck -> outOfRange [label=">228 months"];
    
    // Growth Standards path
    growthStandards -> wfa;
    growthStandards -> hfa;
    growthStandards -> wfh;
    growthStandards -> wfl;
    growthStandards -> bfaStandards;
    
    wfa -> wfaCalc;
    hfa -> hfaCalc;
    wfh -> wfhCalc;
    wfl -> wflCalc;
    bfaStandards -> bfaStandardsCalc;
    
    wfaCalc -> wfaClass;
    hfaCalc -> hfaClass;
    wfhCalc -> wfhClass;
    wflCalc -> wflClass;
    bfaStandardsCalc -> bfaStandardsClass;
    
    // Growth References path
    growthReferences -> bfaReferences;
    bfaReferences -> bfaReferencesCalc;
    bfaReferencesCalc -> bfaReferencesClass;
    
    // Risk assessment (from all paths)
    wfaClass -> riskAssess;
    hfaClass -> riskAssess;
    wfhClass -> riskAssess;
    wflClass -> riskAssess;
    bfaStandardsClass -> riskAssess;
    bfaReferencesClass -> riskAssess;
    
    // Out of range path
    outOfRange -> error;
    
    // Final flow
    riskAssess -> recommendations;
    recommendations -> saveDB;
    saveDB -> output;
    
    // Error flow
    error -> start [label="Retry"];
    
    // Styling for different age ranges
    subgraph cluster_standards {
        label="WHO Growth Standards (0-60 months)";
        style=filled;
        fillcolor="#e8f5e8";
        growthStandards; wfa; hfa; wfh; wfl; bfaStandards;
        wfaCalc; hfaCalc; wfhCalc; wflCalc; bfaStandardsCalc;
        wfaClass; hfaClass; wfhClass; wflClass; bfaStandardsClass;
    }
    
    subgraph cluster_references {
        label="WHO Growth References (61-228 months)";
        style=filled;
        fillcolor="#c8e6c9";
        growthReferences; bfaReferences; bfaReferencesCalc; bfaReferencesClass;
    }
    
    subgraph cluster_assessment {
        label="Risk Assessment & Output";
        style=filled;
        fillcolor="#e3f2fd";
        riskAssess; recommendations; saveDB; output;
    }
}
